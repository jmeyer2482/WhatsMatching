<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="WhatsMatching">
<title>WhatsMatching App - Development • WhatsMatching</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="WhatsMatching App - Development">
<meta property="og:description" content="WhatsMatching">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">WhatsMatching</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Applications.html">Vignette 3 - Applications</a>
    <a class="dropdown-item" href="../articles/Background.html">Vignette 1 - Background</a>
    <a class="dropdown-item" href="../articles/TheApp.html">Vignette 2 - The App</a>
    <a class="dropdown-item" href="../articles/WhatsMatching-HowTo.html">WhatsMatching-HowTo</a>
    <a class="dropdown-item" href="../articles/WhatsMatching-Theory.html">WhatsMatching App - Development</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jmeyer2482/WhatsMatching/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="WhatsMatching-Theory_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="WhatsMatching-Theory_files/plotly-binding-4.10.0/plotly.js"></script><script src="WhatsMatching-Theory_files/typedarray-0.1/typedarray.min.js"></script><link href="WhatsMatching-Theory_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="WhatsMatching-Theory_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="WhatsMatching-Theory_files/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="WhatsMatching-Theory_files/plotly-main-2.5.1/plotly-latest.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>WhatsMatching App - Development</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jmeyer2482/WhatsMatching/blob/HEAD/vignettes/WhatsMatching-Theory.Rmd" class="external-link"><code>vignettes/WhatsMatching-Theory.Rmd</code></a></small>
      <div class="d-none name"><code>WhatsMatching-Theory.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This Shiny App package has been developed with the intention of
providing educational support for understanding matching methods in the
context of causal inference. The initial intention was to deal
specifically with the Propensity Score Paradox highlighted by King and
Neilsen[ref]. Over the development of the app we decided that the
underlying theoretical concepts that inform how matching is conducted by
might be more useful and engaging in an educational environment. This
document outlines the theoretical concepts and development process that
was undertaken to develop the app.</p>
</div>
<div class="section level2">
<h2 id="matching">Matching<a class="anchor" aria-label="anchor" href="#matching"></a>
</h2>
<p>In observational data there is no ability to control which people
receive treatment and which do not. In fact, there is often little
control over the available covariates that may help inform the outcomes.
This potentially exposes observational data to selection bias and
confounding.</p>
<p>Matching is a methodology that is used in the analysis of
observational data. Matching is used as a pre-processing step to assist
in improving the estimate of a given causal effect on an outcome of
interest. The causal variable is generally framed as a binary treatment.
Matching occurs by pairing the individuals, or units, in the dataset
across the treated and untreated groups. The purpose of pairing, or
matching, the data is to find a hidden randomised experiment within the
data. That is to say, to find data within the dataset that is free from
confounding and other bias that is usually automatically accounted for
in a true randomised experiment.</p>
<p>Essentially, when matching is conducted, a type of distance is used
to see how far apart all the treated units are from all the controls.
Then an iterative process takes place whereby each unit is matched to
its nearest neighbour. This process can occur in an order of the
analysts choosing and with or without replacement. At the end, the
remaining units that are unmatched are removed and the analysis occurs
on the matched data which, hopefully, is the hidden experiment you were
looking for.</p>
<p>There are many different ways to calculate the distance between two
units in a dataset. This app and vignette will focus on two commonly
used distances - the propensity score and the mahalanobis distance.</p>
<div class="section level3">
<h3 id="propensity-score">Propensity Score<a class="anchor" aria-label="anchor" href="#propensity-score"></a>
</h3>
<p>The propensity score is the most common way of conducting matching.
It reduces a multidimensional space to a single dimension which allows
for easy matching between units. It is based on theory by Rosenbaum and
Rubin[ref] and relies on logistic regression to determine the
probability that a unit will be treated. Mathematically, <span class="math inline">\(e(x_i) = pr(Z_i=1|x)\)</span> where <span class="math inline">\(e(x_i)\)</span> is the propensity score, <span class="math inline">\(Z\)</span> is the treatment variable, <span class="math inline">\(x\)</span> is a vector of covariates, and <span class="math inline">\(i\)</span> represents an individual.</p>
<p>Many packages in <code>R</code> that perform matching analysis take
the leg work out of calculating the type of distance being used. When
calculating the propensity score for matching the logistic regression
formula looks like <span class="math inline">\(t \sim x_1 + x_2 + ... +
x_n\)</span> where <span class="math inline">\(t\)</span> is the
treatment variable and <span class="math inline">\(x\)</span> represents
a chosen covariate to match on. Once the probabilities have been
calculated then treated units are paired with control units that have
the same or similar probability of treatment.</p>
<p>The propensity score is also widely used for other methods to improve
estimates including weighting and stratification. While these methods
are not the primary purpose of the app, their outcomes have been
provided in the outputs to give some further insights into what
alternative methods may demonstrate.</p>
</div>
<div class="section level3">
<h3 id="mahalanobis-distance">Mahalanobis Distance<a class="anchor" aria-label="anchor" href="#mahalanobis-distance"></a>
</h3>
<p>The Mahalanobis Distance was developed by Prasanta Chandra
Mahalanobis in 1936 as a means of comparing skulls based on their
measurements. It’s normal application calculates how many standard
deviations a point is from the mean of the specified variables and can
give a good indication of outliers in a group. In matching, the
application is similar but not quite the same. Instead of using the mean
as a comparator, each treated unit is compared, pairwise, with each of
the units in the control group.</p>
<p>The pairwise Mahalanobis Distance is calculated by <span class="math inline">\(D_{ij} = (X_i−X_j)W^{−1}(X_i−X_j)^T\)</span> (<a href="https://stats.stackexchange.com/questions/65705/pairwise-mahalanobis-distances" class="external-link uri">https://stats.stackexchange.com/questions/65705/pairwise-mahalanobis-distances</a>)
where <span class="math inline">\(X_i\)</span> and <span class="math inline">\(X_j\)</span> represent the matrix of covariates
for the treated and control groups and <span class="math inline">\(W^{-1}\)</span> is the covariance matrix. Similar
to the Propensity Score, the Mahalanobis Distance reduces a
multidimensional space to a single value representing the distance
between units. A major difference, which will soon be seen, is how the
matches occur between the methods. The Mahalanobis Distance uses the raw
information to calculate the distance between individual units which is
in contrast to the Propensity Score which uses the probability of being
treated to then determine the distance.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-options">Other Options<a class="anchor" aria-label="anchor" href="#other-options"></a>
</h2>
<p>Like most things in statistics, there is more than one way to skin a
cat and matching is no different. As mentioned above, there are other
things that you can do with the matching process to help improve the
results. Three of the things that will be discussed are replacement,
ordering, and caliper application.</p>
<div class="section level3">
<h3 id="replacement">Replacement<a class="anchor" aria-label="anchor" href="#replacement"></a>
</h3>
<p>Replacement can be an important consideration when looking at using
matching. Replacement refers to the re-use of a unit when it is the
closest unit to more than one of the treated units. If we look at this
visually (see Fig ) then we can see that many of the control units that
were included in matching without replacement are dropped. This creates
a tighter group of comparable units for the matched variables and is
more likely to result in covariate balance, one of the primary aims of
matching. It is also the prudent option when you have a dataset that has
equal sized control and treated groups as matching without replacement
will not result in pruning many units.</p>
<p><img src="WhatsMatching-Theory_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="ordering">Ordering<a class="anchor" aria-label="anchor" href="#ordering"></a>
</h3>
<p>The ordering of the matches is only relevant if you are matching
without replacement. If you are matching with replacement then the
nearest match will be used irrespective of what order you are using. The
<code>MatchIt</code> package uses the propensity score as a way of
controlling the order of the matches and data can be matched using one
of four orders - data, smallest, largest, and random.</p>
<p>Ordering by data is just using the data in the order it has in the
dataframe. Ordering by smallest starts with the lowest propensity score
first, or to put it another way, starts with the units that have the
lowest probability of being treated based on the supplied covariates.
Ordering by largest is the same as ordering by smallest but starting
with the highest propensity score. Ordering by random is exactly as it
sounds, the <code>sample</code> function is used on the number of units
to generate a random vector to order the data by.</p>
<p>The <code>MatchIt</code> package has not extended the ability to
order data to the Mahalanobis Distance (as generally the propensity
score is not used in this instance of matching) but for the purposes of
comparison we have included it in the app.</p>
<p><img src="WhatsMatching-Theory_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="calipers">Calipers<a class="anchor" aria-label="anchor" href="#calipers"></a>
</h3>
<p>The application of calipers to the matching process is to essentially
limit the abl</p>
</div>
</div>
<div class="section level2">
<h2 id="matching-visuals">Matching Visuals<a class="anchor" aria-label="anchor" href="#matching-visuals"></a>
</h2>
<p>In order to demonstrate how matching works visually, we will simulate
some data under different conditions to highlight the differences in the
methods. This will purely show how data are matched between groups, we
will look out how that changes the estimate of the treatment effect
later.</p>
<p>All these simulations will contain 60 control units and 40 treated
units and the matches will be completed with both the Propensity Score
and the Mahalanobis Distance.</p>
<p><img src="WhatsMatching-Theory_files/figure-html/unnamed-chunk-4-1.png" width="672"><img src="WhatsMatching-Theory_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
<p>For the purposes of simplicity and uniformity the
<code>optmatch</code> package has been used to generate a distance
matrix using the <code>match_on</code> function. The format of the data
that is returned is the same for both the Mahalanobis Distance and the
Propensity Score. We’ll also be use the <code>fev</code> dataset from
the <code>mplot</code> package which contains a data that is useful for
demonstrating the matching process.</p>
<p>Let’s have a quick look at the data so we know what we’re dealing
with.</p>
<pre><code><span><span class="co">#&gt;   age height sex smoke   fev</span></span>
<span><span class="co">#&gt; 1   9   57.0   0     0 1.708</span></span>
<span><span class="co">#&gt; 2   8   67.5   0     0 1.724</span></span>
<span><span class="co">#&gt; 3   7   54.5   0     0 1.720</span></span>
<span><span class="co">#&gt; 4   9   53.0   1     0 1.558</span></span>
<span><span class="co">#&gt; 5   9   57.0   1     0 1.895</span></span>
<span><span class="co">#&gt; 6   8   61.0   0     0 2.336</span></span></code></pre>
<p>As we can see, there are 5 columns. All the data here is numeric. For
the purpose of this exercise, we want to see what the effect of smoke is
on forced expiratory volume. Therefore, we will use the
<code>smoke</code> variable as the treatment and <code>fev</code> is the
outcome. The remaining covariates are <code>age</code>,
<code>height</code>, and <code>sex</code>.</p>
<p>Let’s have a quick look at the data using <code>ggplot2</code>.</p>
<div class="section level4">
<h4 id="fig-1">Fig 1<a class="anchor" aria-label="anchor" href="#fig-1"></a>
</h4>
<p><img src="WhatsMatching-Theory_files/figure-html/data%20plots1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="fig-2">Fig 2<a class="anchor" aria-label="anchor" href="#fig-2"></a>
</h4>
<p><img src="WhatsMatching-Theory_files/figure-html/data%20plots2-1.png" width="672"></p>
<p>We can see from this quick look at the data that smokers are older,
taller and appear to have a larger FEV. They are also a small subset of
the overall population in the dataset. If we were to map out the
relationships in a directed acyclic graph, it might look something like
this:</p>
</div>
<div class="section level4">
<h4 id="fig-3">Fig 3<a class="anchor" aria-label="anchor" href="#fig-3"></a>
</h4>
<p><img src="WhatsMatching-Theory_files/figure-html/dag-1.png" width="672"></p>
<p>We can see from the relationships here that <code>age</code> is a
confounder as it effects both the exposure (<code>smoke</code>) and the
outcome (<code>fev</code>). <code>height</code> is also important as it
is a mediator. <code>sex</code> appears to be completely accounted for
by <code>height</code>. Now that we have the variables for our model,
let’s look at some methods for matching.</p>
<p>There is more than one way of matching units in a dataset. The two
methods we are looking at here are Propensity Score Matching (PSM) and
Mahalanobis Distance Matching (MDM). We will also look at some of the
different specifications you can make when matching.</p>
<p>Propensity score matching is relatively straight forward. Using
logistic regression, create a vector of probabilities based on the
whether or not each unit is likely to have received the treatment (or
been exposed to subject of interested). We will be using
<code>smoke ~ age + height</code> to determine our matches. For
consistency in output between methods, I have used the
<code>optmatch</code> package to generate the distance matrix.</p>
<p>If we wanted to do the same thing for MDM then we specify it as per
the optmatch documentation. In terms of the differences between the
distance matrices, the propensity score distance matrix is the distance
(or difference) between the calculated propensity score for each unit
whereas the mahalanobis distance matrix will be the actual distance
between the units based on the covariance matrix of <span class="math inline">\(X\)</span>.</p>
<p>Now that we have a distance matrix for each method we can look at
matching.</p>
<p>At this point we can start to specify how the matching occurs.
Options include:<br>
- whether or not to use replacement<br>
- the order the data is matched in (this is really only important if you
aren’t replacing matches)<br>
- whether or not to use a calliper (and how tight to make it)</p>
<p>This exercise is not looking at the use of a calliper. It is also not
exploring exact matching or other more complex match settings. We will
be doing a simple match without replacement, ordered by the data for
both methods.</p>
<p>Each matrix is <span class="math inline">\(m \times n\)</span> where
<span class="math inline">\(m\)</span> represents the treatment group
and <span class="math inline">\(n\)</span> represents the control group.
To get our matches, we sequentially go through each <span class="math inline">\(m\)</span> and select the <span class="math inline">\(n\)</span> with the smallest value until we get to
the last <span class="math inline">\(m\)</span>. When do this with
replacement there is no regard for whether <span class="math inline">\(n\)</span> has been used before, without
replacement mean that the same <span class="math inline">\(n\)</span>
cannot be used twice. Let’s get some matches!</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;    22    43</span></span></code></pre>
<p>OK. Now we have our matches for each method. Let’s see what they look
like visually using <code>ggplot2</code>.</p>
</div>
<div class="section level4">
<h4 id="fig-4">Fig 4<a class="anchor" aria-label="anchor" href="#fig-4"></a>
</h4>
<p><img src="WhatsMatching-Theory_files/figure-html/plot%20matches1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="fig-5">Fig 5<a class="anchor" aria-label="anchor" href="#fig-5"></a>
</h4>
<p><img src="WhatsMatching-Theory_files/figure-html/plot%20matches2-1.png" width="672"></p>
<p>We can see from these two plots that the matches between the groups
are slightly different between methods. For example, the smoker that is
<code>age</code>=15 and <code>height</code>=60 is paired with very
different non-smokers. Overall the matches look quite similar in the
distribution even though there are a few differences between them. Let’s
see if that changes the treatment effect.</p>
<p>There are two ways we can specify how we estimate the treatment
effect on the matched data. The purpose of the matching is to control
confounding and bias. If we are happy that has been done by virtue of
the matching then we need only specify <code>fev ~ smoke</code>.
Alternatively, if we wanted to cover our bases, we could include the
covariates in the model as well -
<code>fev ~ age + height + smoke</code>. Let’s compare them to a model
that contains all the data.</p>
<div id="htmlwidget-51c3ea618b43384d97fd" style="width:672px;height:672px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-51c3ea618b43384d97fd">{"x":{"data":[{"x":[-0.161261538461539,-0.160241570939987,-0.176366600102999,-0.168169811746515],"y":[4,3,2,1],"text":["estimate: -0.161261538<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ smoke<br />model: Mahalanobis Match","estimate: -0.160241571<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ height + smoke<br />model: Mahalanobis Match","estimate: -0.176366600<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ age + smoke<br />model: Mahalanobis Match","estimate: -0.168169812<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ age + height + smoke<br />model: Mahalanobis Match"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Mahalanobis Match","legendgroup":"Mahalanobis Match","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-0.299707692307692,-0.174902603439936,-0.309473778250283,-0.186663978854407],"y":[8,7,6,5],"text":["estimate: -0.299707692<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ smoke<br />model: Propensity Score Match","estimate: -0.174902603<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ height + smoke<br />model: Propensity Score Match","estimate: -0.309473778<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ age + smoke<br />model: Propensity Score Match","estimate: -0.186663979<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ age + height + smoke<br />model: Propensity Score Match"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,56,1)"}},"hoveron":"points","name":"Propensity Score Match","legendgroup":"Propensity Score Match","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.710718923860523,0.00631933141280029,-0.20899487720481,-0.110231930791293],"y":[12,11,10,9],"text":["estimate:  0.710718924<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ smoke<br />model: Unmatched","estimate:  0.006319331<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ height + smoke<br />model: Unmatched","estimate: -0.208994877<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ age + smoke<br />model: Unmatched","estimate: -0.110231931<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ age + height + smoke<br />model: Unmatched"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(97,156,255,1)"}},"hoveron":"points","name":"Unmatched","legendgroup":"Unmatched","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-0.161261538461539,-0.160241570939987,-0.176366600102999,-0.168169811746515],"y":[4,3,2,1],"text":["estimate: -0.161261538<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ smoke<br />model: Mahalanobis Match<br />CI2.5: -0.4218609<br />CI97.5:  0.099337774","estimate: -0.160241571<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ height + smoke<br />model: Mahalanobis Match<br />CI2.5: -0.3402345<br />CI97.5:  0.019751398","estimate: -0.176366600<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ age + smoke<br />model: Mahalanobis Match<br />CI2.5: -0.4231160<br />CI97.5:  0.070382843","estimate: -0.168169812<br />paste0(model, \"\\n\", formula): Mahalanobis Match<br />fev ~ age + height + smoke<br />model: Mahalanobis Match<br />CI2.5: -0.3434284<br />CI97.5:  0.007088727"],"type":"scatter","mode":"lines","opacity":1,"line":{"color":"transparent"},"error_x":{"array":[0.260599312210255,0.179992968522642,0.24674944350406,0.175258538621951],"arrayminus":[0.260599312210254,0.179992968522641,0.246749443504059,0.175258538621951],"type":"data","width":7.34426229508194,"symmetric":false,"color":"rgba(248,118,109,1)"},"name":"Mahalanobis Match","legendgroup":"Mahalanobis Match","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-0.299707692307692,-0.174902603439936,-0.309473778250283,-0.186663978854407],"y":[8,7,6,5],"text":["estimate: -0.299707692<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ smoke<br />model: Propensity Score Match<br />CI2.5: -0.5662238<br />CI97.5: -0.033191603","estimate: -0.174902603<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ height + smoke<br />model: Propensity Score Match<br />CI2.5: -0.3591705<br />CI97.5:  0.009365340","estimate: -0.309473778<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ age + smoke<br />model: Propensity Score Match<br />CI2.5: -0.5630439<br />CI97.5: -0.055903648","estimate: -0.186663979<br />paste0(model, \"\\n\", formula): Propensity Score Match<br />fev ~ age + height + smoke<br />model: Propensity Score Match<br />CI2.5: -0.3654265<br />CI97.5: -0.007901488"],"type":"scatter","mode":"lines","opacity":1,"line":{"color":"transparent"},"error_x":{"array":[0.266516089679564,0.184267943917177,0.253570130574047,0.178762491328397],"arrayminus":[0.266516089679564,0.184267943917177,0.253570130574048,0.178762491328397],"type":"data","width":7.34426229508194,"symmetric":false,"color":"rgba(0,186,56,1)"},"name":"Propensity Score Match","legendgroup":"Propensity Score Match","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.710718923860523,0.00631933141280029,-0.20899487720481,-0.110231930791293],"y":[12,11,10,9],"text":["estimate:  0.710718924<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ smoke<br />model: Unmatched<br />CI2.5:  0.4948346<br />CI97.5:  0.926603253","estimate:  0.006319331<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ height + smoke<br />model: Unmatched<br />CI2.5: -0.1089173<br />CI97.5:  0.121555957","estimate: -0.208994877<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ age + smoke<br />model: Unmatched<br />CI2.5: -0.3675476<br />CI97.5: -0.050442147","estimate: -0.110231931<br />paste0(model, \"\\n\", formula): Unmatched<br />fev ~ age + height + smoke<br />model: Unmatched<br />CI2.5: -0.2280834<br />CI97.5:  0.007619568"],"type":"scatter","mode":"lines","opacity":1,"line":{"color":"transparent"},"error_x":{"array":[0.215884329163382,0.115236625700603,0.158552729751683,0.117851498909675],"arrayminus":[0.215884329163383,0.115236625700603,0.158552729751683,0.117851498909675],"type":"data","width":7.34426229508194,"symmetric":false,"color":"rgba(97,156,255,1)"},"name":"Unmatched","legendgroup":"Unmatched","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":177.534246575343},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.640865133737814,1.00124460477446],"tickmode":"array","ticktext":["-0.5","0.0","0.5","1.0"],"tickvals":[-0.5,0,0.5,1],"categoryorder":"array","categoryarray":["-0.5","0.0","0.5","1.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Estimate","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,12.6],"tickmode":"array","ticktext":["Mahalanobis Match<br />fev ~ age + height + smoke","Mahalanobis Match<br />fev ~ age + smoke","Mahalanobis Match<br />fev ~ height + smoke","Mahalanobis Match<br />fev ~ smoke","Propensity Score Match<br />fev ~ age + height + smoke","Propensity Score Match<br />fev ~ age + smoke","Propensity Score Match<br />fev ~ height + smoke","Propensity Score Match<br />fev ~ smoke","Unmatched<br />fev ~ age + height + smoke","Unmatched<br />fev ~ age + smoke","Unmatched<br />fev ~ height + smoke","Unmatched<br />fev ~ smoke"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12],"categoryorder":"array","categoryarray":["Mahalanobis Match<br />fev ~ age + height + smoke","Mahalanobis Match<br />fev ~ age + smoke","Mahalanobis Match<br />fev ~ height + smoke","Mahalanobis Match<br />fev ~ smoke","Propensity Score Match<br />fev ~ age + height + smoke","Propensity Score Match<br />fev ~ age + smoke","Propensity Score Match<br />fev ~ height + smoke","Propensity Score Match<br />fev ~ smoke","Unmatched<br />fev ~ age + height + smoke","Unmatched<br />fev ~ age + smoke","Unmatched<br />fev ~ height + smoke","Unmatched<br />fev ~ smoke"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Method and Formula for Producing Estimate","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"Method","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4f185b71c47":{"x":{},"y":{},"colour":{},"type":"scatter"},"4f1831de5ce5":{"x":{},"y":{},"colour":{},"xmin":{},"xmax":{}}},"cur_data":"4f185b71c47","visdat":{"4f185b71c47":["function (y) ","x"],"4f1831de5ce5":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><pre><code><span><span class="co">#&gt;                                    rmsea        x2 df    p.value rmsea 2.5%</span></span>
<span><span class="co">#&gt; age _||_ sex                   0.0000000  7.213172 10 0.70517856          0</span></span>
<span><span class="co">#&gt; fev _||_ sex | age, hght, smok 1.0000000 12.000000  6 0.06196880          0</span></span>
<span><span class="co">#&gt; sex _||_ smok                  0.1804387  5.200000  1 0.02258689          0</span></span>
<span><span class="co">#&gt;                                rmsea 97.5%</span></span>
<span><span class="co">#&gt; age _||_ sex                     0.1340545</span></span>
<span><span class="co">#&gt; fev _||_ sex | age, hght, smok   3.2226032</span></span>
<span><span class="co">#&gt; sex _||_ smok                    0.3628085</span></span></code></pre>
<p>The propensity score is a popular choice for matching but using it
appropriately has been a contentious topic in recent years. Let’s look
at why that might be. Below, some data has been simulated with both
<code>X1</code> and <code>X2</code> being mediators between
<code>t</code> (the treatment variable) and <code>y</code> (the outcome
variable). There is a large treatment effect between <code>t</code> and
<code>X2</code> which carries on to <code>y</code>. We can see on the
plot below that there is complete separation between the treated and
control groups with respect to these covariates.</p>
<p><img src="WhatsMatching-Theory_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; [1] y ~ t</span></span>
<span><span class="co">#&gt; t ~ y + X1</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jason Meyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

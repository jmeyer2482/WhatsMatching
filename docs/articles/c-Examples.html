<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="WhatsMatching">
<title>Vignette 3 - Examples • WhatsMatching</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vignette 3 - Examples">
<meta property="og:description" content="WhatsMatching">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">WhatsMatching</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a1-Background.html">Vignette 1a - Background</a>
    <a class="dropdown-item" href="../articles/a2-Development.html">Vignette 1b - Development</a>
    <a class="dropdown-item" href="../articles/b1-TheApp.html">Vignette 2a - The App</a>
    <a class="dropdown-item" href="../articles/b2-DataGen.html">Vignette 2b - Data Generation</a>
    <a class="dropdown-item" href="../articles/b3-Matching.html">Vignette 2c - Matching</a>
    <a class="dropdown-item" href="../articles/c-Examples.html">Vignette 3 - Examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jmeyer2482/WhatsMatching/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Vignette 3 - Examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jmeyer2482/WhatsMatching/blob/HEAD/vignettes/c-Examples.Rmd" class="external-link"><code>vignettes/c-Examples.Rmd</code></a></small>
      <div class="d-none name"><code>c-Examples.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="matching-finds-the-experiment-hidden-in-observational-data">Matching finds the experiment hidden in observational data<a class="anchor" aria-label="anchor" href="#matching-finds-the-experiment-hidden-in-observational-data"></a>
</h2>
<p>This example uses one of the simulations from King and Neilsen’s 2019
paper. It takes three groups representing a fully blocked experiment, a
random experiment and a group of all controls. Covariates
<code>X1</code> and <code>X2</code> are generated with the fully blocked
experiment being almost identically paired between treated and control
units; the random experiment group has randomly placed treated and
control units; and imbalanced control group consists of only control
units and no treated units.</p>
<p>The methods being compared in this example are the use of the
Mahalanobis Distance Matching (MDM) and Propensity Score Matching (PSM).
The outcome demonstrated is that, under these conditions, MDM is
superior to PSM in selecting the fully blocked experiment first. This
occurs because the Propensity score, once calculated, is blind to the
real data that informs the probability of treatment whereas the
Mahalanobis Distance is the actual distance <em>between</em> units.</p>
<table style="border: none; text-align: center;" class="table">
<caption style="text-align:left; caption-side:top;"> Figure 1. Fully Blocked Experiment</caption>
  <tr>
<th style="text-align: left;">Setting</th>
    <th>Method 1</th>
    <th>Method 2</th>
  </tr>
<tr>
<td style="text-align: left;">Matching Distance</td>
    <td>Mahalanobis Distance</td>
    <td>Propensity Score</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Covariates</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Order</td>
    <td>data</td>
    <td>data</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Replacement</td>
    <td>No</td>
    <td>No</td>
  </tr>
<tr>
<td style="text-align: left;">Treatment Effect on the Outcome</td>
    <td colspan="2"><code>y ~ t</code></td>
  </tr>
<tr>
<td colspan="3"><img src="../reference/figures/Ex-fullyblocked.PNG" border="0" width="100%"></td>
  </tr>
</table>
<p><strong>Take home message:</strong> The propensity score may not be
the best choice for achieving covariate balance, which is a primary aim
of matching.</p>
</div>
<div class="section level2">
<h2 id="to-replace-or-not-to-replace">To Replace or Not to Replace<a class="anchor" aria-label="anchor" href="#to-replace-or-not-to-replace"></a>
</h2>
<p>We demonstrate in Fig. 3. that the intuitiveness behind using
replacement may not be clear. This simulation is also from the King ans
Neilsen paper. <code>X1</code> and <code>X2</code> constitute 2
overlapping uniform distributions for the treated and control groups.
There are 200 units in the dataset with 100 units in each group. For
this simulation we have only changed whether the matches are conducted
with replacement.</p>
<p>You can clearly see that there are a number of the control units that
are unmatched. This has occurred because there are other “closer”
controls who can be matched to the treated units. If we look at <em>Plot
3</em> in the panel we can see that the covariate balance has been
maintained and, as we expect, the estimate treatment effect approaches
the true effect.</p>
<table style="border: none; text-align: center;" class="table">
<caption style="text-align:left; caption-side:top;"> Figure 2. Replacement</caption>
  <tr>
<th style="text-align: left;">Setting</th>
    <th>Method 1</th>
    <th>Method 2</th>
  </tr>
<tr>
<td style="text-align: left;">Matching Distance</td>
    <td>Propensity Score</td>
    <td>Propensity Score</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Covariates</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Order</td>
    <td>data</td>
    <td>data</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Replacement</td>
    <td>Yes</td>
    <td>No</td>
  </tr>
<tr>
<td style="text-align: left;">Treatment Effect on the Outcome</td>
    <td colspan="2"><code>y ~ t</code></td>
  </tr>
<tr>
<td colspan="3"><img src="../reference/figures/Ex-replacement.PNG" border="0" width="100%"></td>
  </tr>
</table>
<p><strong>Take home message:</strong> Datasets where the treated and
control groups are approximately equal may require the consideration of
different settings to achieve covariate balance and thus a more accurate
estimate of the treatment effect.</p>
</div>
<div class="section level2">
<h2 id="ordering-changes-unit-selection">Ordering changes unit selection<a class="anchor" aria-label="anchor" href="#ordering-changes-unit-selection"></a>
</h2>
<p>For this example we are using the same simulation as in Fig. 2. This
time we are comparing the ordering of the matches. In this case
comparison is starting with the smallest propensity score versus
starting with the largest. This essentially boils down to matching the
treated units with the lowest probability of being treated first or
starting with those with the highest probability of being treated.</p>
<p>We can see below in Fig. 4. that <em>Plot 1</em> has made some
unusual pairings. This makes some sense as when you pair units that have
the highest probability of being treated first then you quickly increase
the distances between the remaining units that need to be paired. This
means that the “good matches” are getting further and further away.</p>
<p>This is a problem that can occur for any matching method as most
matching methods use nearest neighbour methodology. If the best nearest
neighbour is already paired then the process just moves to the next
available one no matter the distance. This further highlights the
advantage of using replacement which conveniently ignores ordering and
selects the nearest partner irrespective of if it is matched.</p>
<table style="border: none; text-align: center;" class="table">
<caption style="text-align:left; caption-side:top;"> Figure 3. Ordering</caption>
  <tr>
<th style="text-align: left;">Setting</th>
    <th>Method 1</th>
    <th>Method 2</th>
  </tr>
<tr>
<td style="text-align: left;">Matching Distance</td>
    <td>Propensity Score</td>
    <td>Propensity Score</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Covariates</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
    <td>
<code>X1</code>, <code>X2</code>
</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Order</td>
    <td>largest</td>
    <td>smallest</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Replacement</td>
    <td>No</td>
    <td>No</td>
  </tr>
<tr>
<td style="text-align: left;">Treatment Effect on the Outcome</td>
    <td colspan="2"><code>y ~ t</code></td>
  </tr>
<tr>
<td colspan="3"><img src="../reference/figures/Ex-ordering.PNG" border="0" width="100%"></td>
  </tr>
</table>
<p><strong>Take home message:</strong> The ordering or optimisation
method of how the matches are selected can impact what data is selected
for analysis.</p>
</div>
<div class="section level2">
<h2 id="covariate-and-model-selection-matter">Covariate and Model Selection Matter<a class="anchor" aria-label="anchor" href="#covariate-and-model-selection-matter"></a>
</h2>
<p>Covariate specification and model selection are important when
undertaking matching. Ideally, the matching occurs in such a way that
the model specification is less important (another problem for causal
inference in observational data!) which will remove some of the bias.
Simulation 4 has been used for this example with both <code>X1</code>
and <code>X2</code> set to be strong confounders.</p>
<p>Matching has been complete using either <code>X1</code> or
<code>X2</code> as though we don’t know which one is a confounder.
<code>X1</code> has also been added to the formula to calculate the
estimate. These setting have been selected to demonstrate the important
of model and covariate selection when performing matching. As we can see
below, the matching that was done with <code>X1</code> only performed as
well as the raw estimate. Whereas, the model with <code>X2</code>
performed much better.</p>
<table style="border: none; text-align: center;" class="table">
<caption style="text-align:left; caption-side:top;"> Figure 4. Ex-Forgotten-confounder.PNG</caption>
  <tr>
<th style="text-align: left;">Setting</th>
    <th>Method 1</th>
    <th>Method 2</th>
  </tr>
<tr>
<td style="text-align: left;">Matching Distance</td>
    <td>Mahalanobis Distance</td>
    <td>Propensity Score</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Covariates</td>
    <td><code>X1</code></td>
    <td><code>X1</code></td>
  </tr>
<tr>
<td style="text-align: left;">Matching Order</td>
    <td>data</td>
    <td>data</td>
  </tr>
<tr>
<td style="text-align: left;">Matching Replacement</td>
    <td>No</td>
    <td>No</td>
  </tr>
<tr>
<td style="text-align: left;">Treatment Effect on the Outcome</td>
    <td colspan="2"><code>y ~ t + X1</code></td>
  </tr>
<tr>
<td colspan="3"><img src="../reference/figures/Ex-specification.PNG" border="0" width="100%"></td>
  </tr>
</table>
<p><strong>Take home message:</strong> Matching on a variable and then
using it in the estimate of the treatment effect may not yield useful
results.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jason Meyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

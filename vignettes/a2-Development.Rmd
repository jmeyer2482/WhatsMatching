---
title: "Vignette 1b - Development"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette 1b - Development}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: App_References.bib
csl: ama.csl
link-citations: yes
linkcolor: blue
always_allow_html: true
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

```{=html}
<script src="https://kit.fontawesome.com/e10eea7053.js" crossorigin="anonymous"></script>
```
## Development

This project has been developed as a Shiny app using the Golem framework[@Fay2021] to support it's production. There are a number of key functions that have been implemented to generate the data and matching processes. Let's have a look in a bit more detail.

### The golem framework

The <a href="https://golemverse.org/" target="_blank">Golem framework</a> is the brain child of Colin Fay. In essence, Shiny apps are ideal for development as a R package. That is to say that, the package structure lends itself well to the development of production grade Shiny[@Shiny] apps.

The `golem` package itself provides functions and helpers to generate and create the framework that can be used for the development of the Shiny app and package. In addition, there are <a href="https://engineering-shiny.org/" target="_blank"> theoretical underpinnings and best practice advice</a> provided to give the best chance of developing a high quality application.

### Key functions and functionality

There are <a href="https://jmeyer2482.github.io/WhatsMatching/reference/index.html" target="_blank">four key functions</a> that have been developed as part of the package in order to make data generation and analysis as straightforward as possible. They are `create.sim.data`, `matched.data`, `matching.plot`, and `combined.plot`. The functions have been designed to follow and iterative process. The full details for these functions can be found in the *Reference* section.

A fair amount of work for these functions and within the app is done by functions from other packages including `ggplot2`[@ggplot2], `plotly`[@plotly], `dplyr`[@dplyr], and others[@MASS; @boot; @smd; @stats].

#### `create.sim.data()`

As the name suggests, this is the data simulation function. There are four simulations available for use within the app. Each one has a specific type of data generation to explore the matching process.

```{css formatting, echo=FALSE}

table {
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
}

img.figcaption {
  display: table-caption;
  text-align: left;
  caption-side: top;
}


```

```{=html}
<table style="border: none;">
  <caption style="text-align:left; caption-side:top;">Table 1. Data Simulations</caption>
  <tr>
  	<td style="white-space: nowrap;"><em>Simulation 1</em></td>
    <td>Based on King and Neilsen's most simplistic illustration of finding the hidden experiment in the data.</td>
  </tr>
  <tr>
  	<td style="white-space: nowrap;"><em>Simulation 2</em></td> 
    <td>Based on King and Neilsen's illustration to show model dependence and bias.</td>
  </tr>
  <tr>
    <td style="white-space: nowrap;"><em>Simulation 3</em></td>
    <td>Data is generated based on using two covariates with a bivariate normal distribution. The user can change the causal relationships between the covariates and/or the treatment and outcome variables but cannot change the strength of the relationships.<br></td>
  <tr>
  	<td style="white-space: nowrap;"><em>Simulation 4</em></td>
    <td>Uses a bivariate normal distribution to generate data where the user can alter the level of confounding between the covariates and the treatment and outcome variables.</td>
  </tr>
</table>
```
#### `matched.data()`

This is the function that conducts the matching. It primarily uses `match_on()` function in the `optmatch` package[@optmatch] to generate a $n \times p$ matrix of matches for the chosen method, where $n$ represents the control units and $p$ represents the treated units. The output is then used to generate the actual matches along with a number of other outputs that allow further exploration of the data outside of the app if desired. However, it should be noted that this function is not designed for complex matching and, for example, may not be suitable for use with categorical data.

#### `matching.plot()`

This function takes the output from the `matched.data` function and turns it into a `plotly` plot which demonstrates the sequence of matches occurring in a cumulative fashion, starting with the nearest matched pair to the furthest matched pair. Outside the app, this plot can be generated on its own.

#### `combined.plot()`

The `combined.plot` function takes 2 different matching methods generated by the `matched.data` function and returns 4 subplots that highlight the differences between the matching methods. Plots 1 and 2 contain visualisations of the way the data has been matched (via the `matcing.plot` function), Plot 3 shows the standardised mean differences between the specified covariates and methods (specified in the function, not the formula), and Plot 4 shows the differences in the calculated estimate of the treatment effect for both methods. Plots 3 and 4 show the results for each set of matched data as shown in Plots 1 and 2 as a progression through the matching process with fixed values of the unadjusted data. Plot 4 also includes stratified and weighted propensity score estimates for comparison.

### Deployment

The development process for this app has meant that it has been most practical to manage on GitHub. All the associated files and documentation are hosted on <a href="https://github.com/jmeyer2482/WhatsMatching" target="_blank">a public GitHub repository</a>. In terms of the process undertaken, the `WhatsMatching` package is the vehicle for the Shiny App as suggested in Golem framework. From there, `pkgdown` @pkgdown has been used to create the package based website you are now viewing, which is deployed from GitHub.

The end result result of this developmental process means that there is a Shiny App and Package Website that can be used in an educational format. The GitHub hosting means that the package can be installed by running `devtools::install_github("jmeyer2482/Whatsmatching")` in an `R` environment making the functions available to more advanced users. Figure 1 shows the development pathways and output that have been generated from the process.

```{=html}
<table style="border: none;">
  <caption style="text-align:left; caption-side:top;"> Figure 1. Developmental Relationships</caption>
  <tr>
  	  <td style="text-align:center"><img src="../man/figures/dev_pathway.png" border=0 width="100%"> </img></td>
  </tr>
</table>
```

## References

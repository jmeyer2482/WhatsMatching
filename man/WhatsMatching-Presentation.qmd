---
title: "What's Matching?"
authors: c("Jason Meyer","Dr Mark Hanly")
format:
  revealjs:
    theme: beige
    slide-number: true
title-slide-attributes: 
  data-background-image: figures/logo.png
  data-background-position: 17% 44%
  data-background-size: 15%
logo: figures/logo.png
footer: "Dissertation Project: What's Matching. Author: Jason Meyer. Supervisor: Dr Mark Hanly"
header: "What's Matching"
center: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
```

# What's Matching? {style="text-align: center; margin-top: 6px;" background-size="15%" background-position="17% 44%" background-image="figures/logo.png" auto-animate=true}

```{css, echo=FALSE}
.ch h2 {
  text-align: center;
}

.center {
  display: table;
  margin-right: auto;
  margin-left: auto;
}

```


:::notes
-   Hi everyone, My name is Jason Meyer\
-   I've spent the last year, part-time developing this project with my supervisor Dr Mark Hanly\
-   Today I'd like to spend some time telling you about it.
-   In this project we were interested in the methodological approach of matching.
-   This is a very popular approach but it is a bit black box - we don't really see what's happening
-   What's been done for this project is to crack open the matching algorithm so that people can see the guts of it and how it works.
-   The project has been implemented in a Shiny app and today I will briefly show you the app and outline some of the lessons that can be learned from this tool.
:::

## Background {.build .ch}

-   RCTs are the gold standard but often not feasible

-   EHRs and other data sources are now plentiful

![](https://www.rarst.net/images/Comicstripsasultimateformofdailytechhumo_13EF4/comic_dilbert.png){fig-align="center"}

::: notes
-   So, just some quick background...
-   The gold standard for estimating treatment effects is RCTs
-   Unfortunately not all treatments are able to investigated in this way due to feasibility, ethical issues or just being plain impractical
-   Even without these barriers, we now have extensive access to electronic data, particularly in the health care arena\
-   This provides us with lots of opportunity for using data to solve or observe things we may not be able to under normal circumstances\
-   It is not without challenges though. Observational data is not built for this purpose and so the analysis and conclusions need to be considered carefully\
-   One way to deal with these challenges is by using Matching
:::

## Matching {.ch}

-   Commonly used
-   Operations aren't always clear
-   There's also a lot of...

<!--

:::{.columns}
:::{.column width="25%"}

![](https://media.giphy.com/media/l0MYw6Cu1TfY3gsWk/giphy.gif){fig-align="right" width="100%"}

:::

:::{.column width="75%" align="right"}

> "Any sufficiently advanced technology is indistinguishable from magic."\
> <p style='text-align: right;'> Arthur C. Clarke </p>

:::
:::
-->

:::notes
-   Matching is a pre-processing step that is used, in particular, to assist with controlling confounding
-   As I noted earlier, matching is a bit black box
-   King and Neilsen also noted in their 2019 paper that poor applicaiton of the method was likely to be wide spread
-   From working on this project I would say that, anecdotally, this is because there's a lot of...
:::

## Decisions, decisions, decisions {.ch}

<!--
:::{.columns}

:::{.column width="50%"} -->

-   Distance\
-   Covariate selection\
-   Replacement\
-   Ordering\
-   Caliper adjustment

<!-- 
:::


:::{.column width="50%"}
### MAGIC! {style="text-align: center;"} 

{.footnote style="font-size: 10px; text-align: right;"}
source: <https://media.giphy.com/media/l0MYw6Cu1TfY3gsWk/giphy.gif>
::: 
:::

:::
-->

:::notes
-   decision, decisions, decisions!
-   This list of options constitutes the basic suite of options that an analyst must consider when using matching
-   This is not an exhaustive list of possible settings 
-   Additional settings can be required based on what methods have been selected for matching
-   In the interests of time, I won't go into detail here but it's safe to say there are quite a few decisions to make

:::

## We wanted to provide an interactive environment for people to learn about matching {.ch}

:::notes
-   The theories that underpin the particular settings for each matching method are well documented
-   What seems to be lacking is the practical application of the settings and what the implications might be
-   We decided this was an opportunity to develop an interactive environment for people to learn about matching and to understand the possible implications of their decisions 

:::

## The App {.ch}
  
![](figures/App_Main.jpeg){fig-align="center" height="550px"}


:::notes
-   And this is what we've come up with. 
-   This screenshot is the interactive shiny app that we have developed.
-   I'll just quickly give you some context for what you are seeing and then I'll do a demonstration

:::

## Plot 1 and 2 - Matches of the Actual Data {.ch}

<div class = 'center'>
```{r, warning=FALSE}
library(WhatsMatching)
library(dplyr)

d <- create.sim.data()

m1 <- matched.data(t~X1+X2, d, "Mahalanobis")
m2 <- matched.data(t~X1+X2, d, "Propensity Score")


WhatsMatching::matching.plot(m1, "X1", "X2") %>% plotly::layout(showlegend=TRUE)

```
</div>

:::notes

-   In the app Plot 1 & 2 contain the actual data
-   This is a standalone version of Plot 1
-   There is a covariate represented on the x and y axes 
-   the color represents their treatment group - red for treated, blue for control
-   when a bolder observation appears, this represents a matched pair
-   the circles around the single pair indicate the most recently matched pair
-   Plots 1 & 2 are essentially the same. The only difference being that they show the matches for 2 different methods.

:::

## Plot 3 - Standardised Mean Difference {.ch}

<div class = 'center'>
```{r, warning=FALSE}
WhatsMatching:::std.means.plot(m1,m2,"X1","X2","t") %>% 
  plotly::animation_opts(transition = 0, redraw=T, frame=400) %>%
  plotly::animation_slider(currentvalue = list(prefix = "Number of pairs matched: ",
                                         xanchor = "left",
                                         font = list(color="#2d2d2d"))) %>%
  plotly::layout(showlegend=TRUE)
```
</div>

:::notes



:::

## Plot 4 - The Estimate of the Treatment Effect {.ch}

<div class = 'center'>
```{r, warning=FALSE}
WhatsMatching:::estimates.plot(m1,m2,y~t,NULL) %>% 
  plotly::animation_opts(transition = 0, redraw=T, frame=400) %>%
  plotly::animation_slider(currentvalue = list(prefix = "Number of pairs matched: ",
                                         xanchor = "left",
                                         font = list(color="#2d2d2d")))
```
</div>


## How do we use it {.ch}

-   Simulate data
-   Choose settings
-   Watch


# Demonstration time!

:::notes
-   Ok, it's demonstration time. 
-   First I'm going to give you a quick run down of the layout on a screenshot so it makes more sense when it's running 
:::


## What questions can we answer {.ch}
- examples of questions that can be posed


## Development Process {.ch}

![](figures/dev_pathway.png){fig-align="center"}


## Thanks you and links (website + app + code) {.ch}

